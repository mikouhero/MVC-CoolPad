# B 树 与 B+树

B树和2-3树的原理相同，B树也可以是2-4树，2-M树
关于B树有如下的定义，如果一棵B树有M阶（层）：

根节点至少有两个孩子节点
每个节点有M-1个关键字key（节点中的每一个元素叫关键字），并且以升序排列
除去叶子节点和根节点其它节点至少有M/2个孩子节点

### B树的操作
对应的这个3阶树就可以看成2-3树，操作也是相似的
### B树有什么用？
B树大多用在磁盘上用于查找磁盘的地址。因为磁盘会有大量的数据，有可能没有办法一次将需要的所有数据加入到内存中，所以只能逐一加载磁盘页，每个磁盘页就对应一个节点，而对于B树来说，B树很好的将树的高度降低了，这样就会减少IO查询次数，虽然一次加载到内存的数据变多了，但速度绝对快于AVL或是红黑树的。

### B+树 定义
B+树和B树类似，但多了几条规则

    非叶子结点的子树指针个数与关键字（节点中的元素个数）个数相同
    非叶子结点的子树指针P[i]，指向关键字值属于[K[i], K[i+1])的子树（B-树是开区间）
    所有叶子结点有一个链指针
    所有关键字都在叶子结点出现
    只有叶子节点有Data域

![](https://user-gold-cdn.xitu.io/2019/6/4/16b22b355f4cf7e6)

可以看到最主要的区别就是在叶子节点，叶子节点通过一个sqt将所有叶子节点链成一个链表，并且只有叶子节点有data域（data域就是索引指向的磁盘地址）

### B+树的操作
B+树和B树的操作的优势在于B+树的查找效率上，所以下面具体看查询
   -  B树中每个节点的关键字都有data域，而B+树除了叶子节点，其他节点只有索引，也就是说同样的磁盘页B+树可以容纳更多的元素。
   -  B+树的范围查询更加方便，可以先找到范围下限，然后通过叶子结点的链表顺序遍历，直至找到上限即可。而B树只能先找到下限，通过中序遍历查找，直到找到上限。

至于其他操作就和2-3树相似


### mysql的Innodb引擎采用B+树的索引方式
总结了这些树形结构，再对mysql中innodb存储引擎为什么使用B+树作为索引做个总结

##### 为什么不用AVL或红黑树？     

我们假设B+树一个节点可以有100个关键字，那么3层的B树可以容纳大概1000000多个关键字（100+101*100+101*101*100）。而红黑树要存储这么多至少要20层。所以使用B树相对于红黑树和AVL可以减少IO操作
##### 为什么不用数组或链表？
链表查询速度慢。数组要开辟连续空间不可能。

##### 为什么不用哈希表？
Innodb能够进行范围查询，哈希表无法实现。例如LIKE很难用哈希表实现

##### 为什么不用B树？
B+树只有叶子节点存放数据，而其他节点只存放索引，而B树每个节点都有Data域。所以相同大小的节点B+树包含的索引比B树的索引更多（因为B树每个节点还有Data域）

还有就是B+树的叶子节点是通过链表连接的，所以找到下限后能很快进行区间查询，比B树中序遍历快

