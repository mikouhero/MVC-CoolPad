

# 意向锁（InnoDB 特有）
意向锁的意义在于方便检测表锁和行锁之间的冲突

意向锁是一种表级锁，代表要对某行记录进行操作。分为意向共享锁 (IS) 和意向排他锁 (IX)。

- 行锁与表锁之间的冲突 
    + 事务 A 给表中的某一行加了共享锁，让这一行只能读不能写。之后事务 B 申请整个表的排他锁。如果事务 B 申请成功，那么它就能修改表中的任意一行，这与 A 持有的行锁是冲突的。InnoDB 引入了意向锁来判断它们之间的冲突。

- 没有意向锁的情况：
    + 1、判断表是否已被其他事务用表锁锁表。
    + 2、判断表中的每一行是否已被行锁锁住，这样要遍历整个表，效率很低。

- 意向锁存在的情况：
    + 1、判断表是否已被其他事务用表锁锁表。
    + 2、判断表上是否有意向锁

-  意向锁存在时申请锁：
    +  申请意向锁的动作是数据库完成的 ，上述例子中事务 A 申请一行的行锁的时候，数据库会自动先开始申请表的意向锁，当事务 B 申请表的排他锁时检测到存在意向锁则会阻塞。
- 意向锁会不会存在冲突：
    +  意向锁之间不会冲突，因为意向锁只是代表要对某行记录进行操作。
