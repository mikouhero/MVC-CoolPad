# 死锁
两个或两个以上的事务在执行过程中，因争夺资源而造成的一种互相等待的现象。

### 存在条件：
    1、 互斥条件：一个资源每次只能被一个事务使用。    
    2、 请求与保持条件：一个事务因请求资源而阻塞时，对已获得的资源保持不放。   
    3、不剥夺条件：已获得的资源，在末使用完之前不能强行剥夺。   
    4、循环等待条件：形成一种头尾相接的循环等待关系    

### 解除正在死锁的状态：撤销其中一个事务

### 避免死锁
    
    1）以固定的顺序访问表和行。比如对两个job批量更新的情形，简单方法是对id列表先排序，后执行，这样就避免了交叉等待锁的情形；将两个事务的sql顺序调整为一致，也能避免死锁。     
    2）大事务拆小。大事务更倾向于死锁，如果业务允许，将大事务拆小。        
    3）在同一个事务中，尽可能做到一次锁定所需要的所有资源，减少死锁概率。     
    4）降低隔离级别。如果业务允许，将隔离级别调低也是较好的选择，比如将隔离级别从RR调整为RC，可以避免掉很多因为gap锁造成的死锁。      
    5）为表添加合理的索引。可以看到如果不走索引将会为表的每一行记录添加上锁，死锁的概率大大增大。     

